

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>langlint.parsers.python_parser &mdash; LangLint 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            LangLint
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command-Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/core.html">Core Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/parsers.html">Parsers Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/translators.html">Translators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">LangLint</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">langlint.parsers.python_parser</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for langlint.parsers.python_parser</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Python parser for extracting translatable text from Python files.</span>

<span class="sd">This parser uses Python&#39;s built-in tokenize module to precisely extract</span>
<span class="sd">comments and docstrings while preserving the exact structure of the code.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">tokenize</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parser</span><span class="p">,</span> <span class="n">TranslatableUnit</span><span class="p">,</span> <span class="n">ParseResult</span><span class="p">,</span> <span class="n">UnitType</span><span class="p">,</span> <span class="n">ParseError</span>


<div class="viewcode-block" id="PythonToken">
<a class="viewcode-back" href="../../../api/parsers.html#langlint.parsers.python_parser.PythonToken">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PythonToken</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a Python token with position information.&quot;&quot;&quot;</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">string</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>  <span class="c1"># (line, column)</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">str</span></div>



<div class="viewcode-block" id="PythonParser">
<a class="viewcode-back" href="../../../api/parsers.html#langlint.parsers.python_parser.PythonParser">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PythonParser</span><span class="p">(</span><span class="n">Parser</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parser for Python files that extracts comments and docstrings.</span>

<span class="sd">    This parser uses Python&#39;s tokenize module to precisely identify</span>
<span class="sd">    and extract translatable text while maintaining exact positioning</span>
<span class="sd">    information for reconstruction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supported_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return supported file extensions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;.pyi&#39;</span><span class="p">,</span> <span class="s1">&#39;.pyw&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">supported_mime_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return supported MIME types.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;text/x-python&#39;</span><span class="p">,</span>
            <span class="s1">&#39;application/x-python-code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;text/x-python-script&#39;</span>
        <span class="p">]</span>

<div class="viewcode-block" id="PythonParser.can_parse">
<a class="viewcode-back" href="../../../api/parsers.html#langlint.parsers.python_parser.PythonParser.can_parse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">can_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if this parser can handle the given file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to the file</span>
<span class="sd">            content: Optional file content</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this parser can handle the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_extensions</span><span class="p">))</span>

        <span class="c1"># Simple heuristic: check for Python-specific patterns</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">content</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Must have Python-specific patterns</span>
        <span class="n">python_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;def &#39;</span><span class="p">,</span> <span class="s1">&#39;class &#39;</span><span class="p">,</span> <span class="s1">&#39;import &#39;</span><span class="p">,</span> <span class="s1">&#39;from &#39;</span><span class="p">,</span> <span class="s1">&#39;if &#39;</span><span class="p">,</span> <span class="s1">&#39;for &#39;</span><span class="p">,</span> <span class="s1">&#39;while &#39;</span><span class="p">,</span>
            <span class="s1">&#39;return &#39;</span><span class="p">,</span> <span class="s1">&#39;yield &#39;</span><span class="p">,</span> <span class="s1">&#39;async &#39;</span><span class="p">,</span> <span class="s1">&#39;await &#39;</span><span class="p">,</span> <span class="s1">&#39;try:&#39;</span><span class="p">,</span> <span class="s1">&#39;except:&#39;</span><span class="p">,</span>
            <span class="s1">&#39;finally:&#39;</span><span class="p">,</span> <span class="s1">&#39;with &#39;</span><span class="p">,</span> <span class="s1">&#39;lambda &#39;</span><span class="p">,</span> <span class="s1">&#39;and &#39;</span><span class="p">,</span> <span class="s1">&#39;or &#39;</span><span class="p">,</span> <span class="s1">&#39;not &#39;</span><span class="p">,</span>
            <span class="s1">&#39;in &#39;</span><span class="p">,</span> <span class="s1">&#39;is &#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;+=&#39;</span><span class="p">,</span> <span class="s1">&#39;-=&#39;</span><span class="p">,</span>
            <span class="s1">&#39;**&#39;</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span>
        <span class="p">]</span>

        <span class="n">has_python_patterns</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">sample</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">python_patterns</span><span class="p">)</span>

        <span class="c1"># Additional check: if it&#39;s just plain text, reject</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_python_patterns</span><span class="p">:</span>
            <span class="c1"># Check if it looks like plain text (no Python syntax)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># If multiple lines but no Python syntax, likely not Python</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">has_python_patterns</span></div>


<div class="viewcode-block" id="PythonParser.extract_translatable_units">
<a class="viewcode-back" href="../../../api/parsers.html#langlint.parsers.python_parser.PythonParser.extract_translatable_units">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_translatable_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParseResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract translatable units from Python file content.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: The file content to parse</span>
<span class="sd">            file_path: Path to the file</span>

<span class="sd">        Returns:</span>
<span class="sd">            ParseResult containing all translatable units found</span>

<span class="sd">        Raises:</span>
<span class="sd">            ParseError: If the file cannot be parsed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Tokenize the content</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_content</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

            <span class="c1"># Extract translatable units</span>
            <span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">line_count</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_translatable_unit</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
                    <span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ParseResult</span><span class="p">(</span>
                <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
                <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
                <span class="n">line_count</span><span class="o">=</span><span class="n">line_count</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;parser&quot;</span><span class="p">:</span> <span class="s2">&quot;PythonParser&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse Python file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span></div>


<div class="viewcode-block" id="PythonParser.reconstruct_file">
<a class="viewcode-back" href="../../../api/parsers.html#langlint.parsers.python_parser.PythonParser.reconstruct_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">original_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">translated_units</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TranslatableUnit</span><span class="p">],</span>
        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reconstruct the file content with translated units.</span>

<span class="sd">        Args:</span>
<span class="sd">            original_content: The original file content</span>
<span class="sd">            translated_units: List of translated units</span>
<span class="sd">            file_path: Path to the file</span>

<span class="sd">        Returns:</span>
<span class="sd">            The reconstructed file content with translations applied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a mapping of original content to translated content</span>
        <span class="n">translation_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">translated_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">and</span> <span class="s1">&#39;original_content&#39;</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                <span class="n">original</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;original_content&#39;</span><span class="p">]</span>
                <span class="c1"># Store the unit itself to preserve metadata</span>
                <span class="n">translation_map</span><span class="p">[</span><span class="n">original</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span>

        <span class="c1"># Tokenize the original content</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_content</span><span class="p">(</span><span class="n">original_content</span><span class="p">)</span>

        <span class="c1"># Reconstruct the file</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">original_content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Process tokens in reverse order to avoid line number issues</span>
        <span class="c1"># when deleting lines for multi-line tokens</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">COMMENT</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">string</span> <span class="ow">in</span> <span class="n">translation_map</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">translation_map</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">]</span>
                    <span class="c1"># For comments, rebuild with # prefix</span>
                    <span class="n">new_token</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">unit</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_replace_token_in_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">new_token</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">string</span> <span class="ow">in</span> <span class="n">translation_map</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">translation_map</span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">]</span>
                    <span class="c1"># For strings, preserve the original quote style</span>
                    <span class="n">new_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rebuild_string_token</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_replace_token_in_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">new_token</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_tokenize_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PythonToken</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tokenize Python content and return a list of tokens.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Python source code</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of PythonToken objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">token_info</span> <span class="ow">in</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">generate_tokens</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">readline</span><span class="p">):</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">PythonToken</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">token_info</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                    <span class="n">string</span><span class="o">=</span><span class="n">token_info</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
                    <span class="n">start</span><span class="o">=</span><span class="n">token_info</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                    <span class="n">end</span><span class="o">=</span><span class="n">token_info</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">token_info</span><span class="o">.</span><span class="n">line</span>
                <span class="p">)</span>
                <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">TokenError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tokenization error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">tokens</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_translatable_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">PythonToken</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TranslatableUnit</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a translatable unit from a Python token.</span>

<span class="sd">        Args:</span>
<span class="sd">            token: Python token</span>
<span class="sd">            content: Original file content</span>

<span class="sd">        Returns:</span>
<span class="sd">            TranslatableUnit if the token is translatable, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">COMMENT</span><span class="p">:</span>
            <span class="c1"># Single-line comment</span>
            <span class="n">comment_text</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove # and whitespace</span>
            <span class="k">if</span> <span class="n">comment_text</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_translatable_text</span><span class="p">(</span><span class="n">comment_text</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">TranslatableUnit</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">comment_text</span><span class="p">,</span>
                    <span class="n">unit_type</span><span class="o">=</span><span class="n">UnitType</span><span class="o">.</span><span class="n">COMMENT</span><span class="p">,</span>
                    <span class="n">line_number</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">column_number</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Convert from 0-based to 1-based</span>
                    <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Comment in </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;original_content&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
                        <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;comment&#39;</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="c1"># String literal (including docstrings)</span>
            <span class="n">string_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_string_content</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">string_text</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_translatable_text</span><span class="p">(</span><span class="n">string_text</span><span class="p">):</span>
                <span class="c1"># Determine if it&#39;s a docstring or regular string</span>
                <span class="n">unit_type</span> <span class="o">=</span> <span class="n">UnitType</span><span class="o">.</span><span class="n">DOCSTRING</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_docstring</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="k">else</span> <span class="n">UnitType</span><span class="o">.</span><span class="n">STRING_LITERAL</span>

                <span class="k">return</span> <span class="n">TranslatableUnit</span><span class="p">(</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">string_text</span><span class="p">,</span>
                    <span class="n">unit_type</span><span class="o">=</span><span class="n">unit_type</span><span class="p">,</span>
                    <span class="n">line_number</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">column_number</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Convert from 0-based to 1-based</span>
                    <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;String literal: </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                        <span class="s1">&#39;original_content&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">string</span><span class="p">,</span>
                        <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;is_docstring&#39;</span><span class="p">:</span> <span class="n">unit_type</span> <span class="o">==</span> <span class="n">UnitType</span><span class="o">.</span><span class="n">DOCSTRING</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_string_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the actual content from a string token.</span>

<span class="sd">        Args:</span>
<span class="sd">            string_token: The string token (including quotes)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The string content without quotes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove quotes and handle escape sequences</span>
        <span class="c1"># Handle f-strings, r-strings, b-strings, etc.</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">string_token</span>

        <span class="c1"># Check for string prefixes (f, r, b, u, fr, rf, br, rb, etc.)</span>
        <span class="k">while</span> <span class="n">token</span> <span class="ow">and</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s1">&#39;frbufrburfbr&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">):</span>
            <span class="c1"># Multi-line string</span>
            <span class="k">return</span> <span class="n">token</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
            <span class="c1"># Single-line string</span>
            <span class="k">return</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">string_token</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_docstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">PythonToken</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if a string token is a docstring.</span>

<span class="sd">        Args:</span>
<span class="sd">            token: String token to check</span>
<span class="sd">            content: Original file content</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the token is a docstring</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if it&#39;s at the module level or at the beginning of a function/class</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">line_num</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">line_num</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>

        <span class="c1"># Check for docstring patterns</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="c1"># Check if it&#39;s at the start of a function, class, or module</span>
            <span class="n">stripped_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Check if it&#39;s the first statement in a function/class</span>
            <span class="c1"># This is a simplified check - a full implementation would need AST parsing</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_translatable_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if text should be translated.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the text should be translated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Skip empty or whitespace-only text</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip very short text (likely not meaningful)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip text that&#39;s mostly punctuation or symbols</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">text</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip shebang lines</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#!&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip shebang content (without the #)</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!/&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip single character comments</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip text that&#39;s mostly code or technical terms</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_mostly_code</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip Python special identifiers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_python_special_identifier</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip technical strings (single words, short phrases)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_technical_string</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Skip URLs and email addresses</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_url_or_email</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Only translate text containing non-English (non-ASCII) characters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains_non_english</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_mostly_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if text is mostly code rather than natural language.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the text appears to be mostly code</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check for strong code indicators (more specific patterns)</span>
        <span class="n">strong_code_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;import &#39;</span><span class="p">,</span> <span class="s1">&#39;from &#39;</span><span class="p">,</span> <span class="s1">&#39;def &#39;</span><span class="p">,</span> <span class="s1">&#39;class &#39;</span><span class="p">,</span> <span class="s1">&#39;return &#39;</span><span class="p">,</span> <span class="s1">&#39;yield &#39;</span><span class="p">,</span>
            <span class="s1">&#39;try:&#39;</span><span class="p">,</span> <span class="s1">&#39;except:&#39;</span><span class="p">,</span> <span class="s1">&#39;finally:&#39;</span><span class="p">,</span> <span class="s1">&#39;raise &#39;</span><span class="p">,</span> <span class="s1">&#39;assert &#39;</span><span class="p">,</span>
            <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;+=&#39;</span><span class="p">,</span> <span class="s1">&#39;-=&#39;</span><span class="p">,</span> <span class="s1">&#39;*=&#39;</span><span class="p">,</span> <span class="s1">&#39;/=&#39;</span><span class="p">,</span>
            <span class="s1">&#39;()&#39;</span><span class="p">,</span> <span class="s1">&#39;[]&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">t&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">r&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Check for weaker code indicators (could also be natural language)</span>
        <span class="n">weak_code_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>
        <span class="p">]</span>

        <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">strong_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">strong_code_patterns</span> <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">text_lower</span><span class="p">)</span>
        <span class="n">weak_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">weak_code_patterns</span> <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">text_lower</span><span class="p">)</span>

        <span class="n">word_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="c1"># If there are strong code indicators, it&#39;s likely code</span>
        <span class="k">if</span> <span class="n">strong_count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># If there are many weak indicators relative to word count, it&#39;s likely code</span>
        <span class="k">if</span> <span class="n">weak_count</span> <span class="o">&gt;</span> <span class="n">word_count</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_python_special_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if text is a Python special identifier that shouldn&#39;t be translated.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the text is a Python special identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Python special identifiers and keywords</span>
        <span class="n">special_identifiers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="s1">&#39;__str__&#39;</span><span class="p">,</span> <span class="s1">&#39;__repr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__next__&#39;</span><span class="p">,</span> <span class="s1">&#39;__enter__&#39;</span><span class="p">,</span> <span class="s1">&#39;__exit__&#39;</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__setitem__&#39;</span><span class="p">,</span> <span class="s1">&#39;__delitem__&#39;</span><span class="p">,</span> <span class="s1">&#39;__contains__&#39;</span><span class="p">,</span> <span class="s1">&#39;__bool__&#39;</span><span class="p">,</span> <span class="s1">&#39;__int__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__float__&#39;</span><span class="p">,</span> <span class="s1">&#39;__complex__&#39;</span><span class="p">,</span> <span class="s1">&#39;__round__&#39;</span><span class="p">,</span> <span class="s1">&#39;__trunc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__floor__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__ceil__&#39;</span><span class="p">,</span> <span class="s1">&#39;__abs__&#39;</span><span class="p">,</span> <span class="s1">&#39;__pos__&#39;</span><span class="p">,</span> <span class="s1">&#39;__neg__&#39;</span><span class="p">,</span> <span class="s1">&#39;__invert__&#39;</span><span class="p">,</span> <span class="s1">&#39;__add__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__sub__&#39;</span><span class="p">,</span> <span class="s1">&#39;__mul__&#39;</span><span class="p">,</span> <span class="s1">&#39;__truediv__&#39;</span><span class="p">,</span> <span class="s1">&#39;__floordiv__&#39;</span><span class="p">,</span> <span class="s1">&#39;__mod__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__divmod__&#39;</span><span class="p">,</span> <span class="s1">&#39;__pow__&#39;</span><span class="p">,</span> <span class="s1">&#39;__lshift__&#39;</span><span class="p">,</span> <span class="s1">&#39;__rshift__&#39;</span><span class="p">,</span> <span class="s1">&#39;__and__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__or__&#39;</span><span class="p">,</span> <span class="s1">&#39;__xor__&#39;</span><span class="p">,</span> <span class="s1">&#39;__lt__&#39;</span><span class="p">,</span> <span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="s1">&#39;__eq__&#39;</span><span class="p">,</span> <span class="s1">&#39;__ne__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__gt__&#39;</span><span class="p">,</span> <span class="s1">&#39;__ge__&#39;</span><span class="p">,</span> <span class="s1">&#39;__hash__&#39;</span><span class="p">,</span> <span class="s1">&#39;__getattr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__setattr__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__delattr__&#39;</span><span class="p">,</span> <span class="s1">&#39;__dir__&#39;</span><span class="p">,</span> <span class="s1">&#39;__getattribute__&#39;</span><span class="p">,</span> <span class="s1">&#39;__setattribute__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__delattribute__&#39;</span><span class="p">,</span> <span class="s1">&#39;__new__&#39;</span><span class="p">,</span> <span class="s1">&#39;__init_subclass__&#39;</span><span class="p">,</span> <span class="s1">&#39;__class_getitem__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="s1">&#39;__bases__&#39;</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__qualname__&#39;</span><span class="p">,</span> <span class="s1">&#39;__module__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;__annotations__&#39;</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span><span class="p">,</span> <span class="s1">&#39;__slots__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__mro__&#39;</span><span class="p">,</span> <span class="s1">&#39;__mro_entries__&#39;</span><span class="p">,</span> <span class="s1">&#39;__subclasscheck__&#39;</span><span class="p">,</span> <span class="s1">&#39;__subclasshook__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__instancecheck__&#39;</span><span class="p">,</span> <span class="s1">&#39;__abstractmethods__&#39;</span><span class="p">,</span> <span class="s1">&#39;__isabstractmethod__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__wrapped__&#39;</span><span class="p">,</span> <span class="s1">&#39;__wrapped__&#39;</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__func__&#39;</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">,</span>
            <span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Ellipsis&#39;</span><span class="p">,</span> <span class="s1">&#39;NotImplemented&#39;</span><span class="p">,</span> <span class="s1">&#39;Exception&#39;</span><span class="p">,</span> <span class="s1">&#39;BaseException&#39;</span><span class="p">,</span>
            <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;property&#39;</span><span class="p">,</span> <span class="s1">&#39;staticmethod&#39;</span><span class="p">,</span> <span class="s1">&#39;classmethod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;super&#39;</span><span class="p">,</span> <span class="s1">&#39;isinstance&#39;</span><span class="p">,</span> <span class="s1">&#39;issubclass&#39;</span><span class="p">,</span> <span class="s1">&#39;hasattr&#39;</span><span class="p">,</span> <span class="s1">&#39;getattr&#39;</span><span class="p">,</span>
            <span class="s1">&#39;setattr&#39;</span><span class="p">,</span> <span class="s1">&#39;delattr&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">,</span> <span class="s1">&#39;locals&#39;</span><span class="p">,</span> <span class="s1">&#39;globals&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">,</span>
            <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;enumerate&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span>
            <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;sorted&#39;</span><span class="p">,</span> <span class="s1">&#39;reversed&#39;</span><span class="p">,</span> <span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;oct&#39;</span><span class="p">,</span> <span class="s1">&#39;hex&#39;</span><span class="p">,</span> <span class="s1">&#39;chr&#39;</span><span class="p">,</span> <span class="s1">&#39;ord&#39;</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;repr&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">,</span>
            <span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;tuple&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span>
            <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;frozenset&#39;</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;bytearray&#39;</span><span class="p">,</span> <span class="s1">&#39;memoryview&#39;</span><span class="p">,</span>
            <span class="s1">&#39;slice&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;enumerate&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reversed&#39;</span><span class="p">,</span> <span class="s1">&#39;sorted&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
            <span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;divmod&#39;</span><span class="p">,</span> <span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isinstance&#39;</span><span class="p">,</span> <span class="s1">&#39;issubclass&#39;</span><span class="p">,</span> <span class="s1">&#39;callable&#39;</span><span class="p">,</span> <span class="s1">&#39;getattr&#39;</span><span class="p">,</span> <span class="s1">&#39;setattr&#39;</span><span class="p">,</span>
            <span class="s1">&#39;delattr&#39;</span><span class="p">,</span> <span class="s1">&#39;hasattr&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">,</span> <span class="s1">&#39;vars&#39;</span><span class="p">,</span> <span class="s1">&#39;locals&#39;</span><span class="p">,</span> <span class="s1">&#39;globals&#39;</span><span class="p">,</span>
            <span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;print&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;len&#39;</span><span class="p">,</span>
            <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;enumerate&#39;</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span>
            <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;sorted&#39;</span><span class="p">,</span> <span class="s1">&#39;reversed&#39;</span><span class="p">,</span> <span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">special_identifiers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_technical_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if text is a technical string that shouldn&#39;t be translated.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the text is a technical string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Skip single words that are likely technical terms</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Common technical single words</span>
            <span class="n">technical_words</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;demo&#39;</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;settings&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span>
                <span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span>
                <span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;enum&#39;</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span>
                <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;trace&#39;</span><span class="p">,</span> <span class="s1">&#39;stack&#39;</span><span class="p">,</span>
                <span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;trace&#39;</span><span class="p">,</span>
                <span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="s1">&#39;silent&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="s1">&#39;slow&#39;</span><span class="p">,</span>
                <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">,</span> <span class="s1">&#39;tiny&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span>
                <span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;speed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span>
                <span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;millisecond&#39;</span><span class="p">,</span> <span class="s1">&#39;microsecond&#39;</span><span class="p">,</span> <span class="s1">&#39;nanosecond&#39;</span><span class="p">,</span>
                <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">,</span>
                <span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="s1">&#39;stopped&#39;</span><span class="p">,</span>
                <span class="s1">&#39;paused&#39;</span><span class="p">,</span> <span class="s1">&#39;resumed&#39;</span><span class="p">,</span> <span class="s1">&#39;started&#39;</span><span class="p">,</span> <span class="s1">&#39;finished&#39;</span><span class="p">,</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;failed&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="s1">&#39;okay&#39;</span><span class="p">,</span> <span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="s1">&#39;great&#39;</span><span class="p">,</span>
                <span class="s1">&#39;awesome&#39;</span><span class="p">,</span> <span class="s1">&#39;cool&#39;</span><span class="p">,</span> <span class="s1">&#39;nice&#39;</span><span class="p">,</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span> <span class="s1">&#39;excellent&#39;</span><span class="p">,</span> <span class="s1">&#39;wonderful&#39;</span><span class="p">,</span>
                <span class="s1">&#39;amazing&#39;</span><span class="p">,</span> <span class="s1">&#39;incredible&#39;</span><span class="p">,</span> <span class="s1">&#39;fantastic&#39;</span><span class="p">,</span> <span class="s1">&#39;terrible&#39;</span><span class="p">,</span> <span class="s1">&#39;awful&#39;</span><span class="p">,</span>
                <span class="s1">&#39;horrible&#39;</span><span class="p">,</span> <span class="s1">&#39;disgusting&#39;</span><span class="p">,</span> <span class="s1">&#39;ugly&#39;</span><span class="p">,</span> <span class="s1">&#39;beautiful&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cute&#39;</span><span class="p">,</span> <span class="s1">&#39;lovely&#39;</span><span class="p">,</span> <span class="s1">&#39;sweet&#39;</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">,</span> <span class="s1">&#39;nice&#39;</span><span class="p">,</span> <span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;bad&#39;</span><span class="p">,</span>
                <span class="s1">&#39;evil&#39;</span><span class="p">,</span> <span class="s1">&#39;wrong&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;correct&#39;</span><span class="p">,</span> <span class="s1">&#39;incorrect&#39;</span><span class="p">,</span> <span class="s1">&#39;valid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;invalid&#39;</span><span class="p">,</span> <span class="s1">&#39;legal&#39;</span><span class="p">,</span> <span class="s1">&#39;illegal&#39;</span><span class="p">,</span> <span class="s1">&#39;allowed&#39;</span><span class="p">,</span> <span class="s1">&#39;forbidden&#39;</span><span class="p">,</span>
                <span class="s1">&#39;permitted&#39;</span><span class="p">,</span> <span class="s1">&#39;denied&#39;</span><span class="p">,</span> <span class="s1">&#39;granted&#39;</span><span class="p">,</span> <span class="s1">&#39;refused&#39;</span><span class="p">,</span> <span class="s1">&#39;accepted&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rejected&#39;</span><span class="p">,</span> <span class="s1">&#39;approved&#39;</span><span class="p">,</span> <span class="s1">&#39;disapproved&#39;</span><span class="p">,</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;denied&#39;</span><span class="p">,</span>
                <span class="c1"># Common dictionary keys and technical identifiers</span>
                <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;user_type&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span>
                <span class="s1">&#39;last_login&#39;</span><span class="p">,</span> <span class="s1">&#39;is_active&#39;</span><span class="p">,</span> <span class="s1">&#39;login_time&#39;</span><span class="p">,</span> <span class="s1">&#39;permissions&#39;</span><span class="p">,</span>
                <span class="s1">&#39;session_id&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;guest&#39;</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">,</span>
                <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;manage_users&#39;</span><span class="p">,</span> <span class="s1">&#39;admin123&#39;</span><span class="p">,</span> <span class="s1">&#39;user123&#39;</span><span class="p">,</span> <span class="s1">&#39;guest123&#39;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">technical_words</span>

        <span class="c1"># Skip common technical phrases</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">technical_phrases</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;hello world&#39;</span><span class="p">,</span> <span class="s1">&#39;hello, world&#39;</span><span class="p">,</span> <span class="s1">&#39;hello, world!&#39;</span><span class="p">,</span> <span class="s1">&#39;hello world!&#39;</span><span class="p">,</span>
                <span class="s1">&#39;test case&#39;</span><span class="p">,</span> <span class="s1">&#39;demo app&#39;</span><span class="p">,</span> <span class="s1">&#39;example code&#39;</span><span class="p">,</span> <span class="s1">&#39;sample data&#39;</span><span class="p">,</span>
                <span class="s1">&#39;config file&#39;</span><span class="p">,</span> <span class="s1">&#39;settings file&#39;</span><span class="p">,</span> <span class="s1">&#39;options menu&#39;</span><span class="p">,</span> <span class="s1">&#39;input field&#39;</span><span class="p">,</span>
                <span class="s1">&#39;output field&#39;</span><span class="p">,</span> <span class="s1">&#39;result set&#39;</span><span class="p">,</span> <span class="s1">&#39;data table&#39;</span><span class="p">,</span> <span class="s1">&#39;error message&#39;</span><span class="p">,</span>
                <span class="s1">&#39;warning message&#39;</span><span class="p">,</span> <span class="s1">&#39;info message&#39;</span><span class="p">,</span> <span class="s1">&#39;debug info&#39;</span><span class="p">,</span> <span class="s1">&#39;log file&#39;</span><span class="p">,</span>
                <span class="s1">&#39;trace file&#39;</span><span class="p">,</span> <span class="s1">&#39;stack trace&#39;</span><span class="p">,</span> <span class="s1">&#39;exception handler&#39;</span><span class="p">,</span> <span class="s1">&#39;error handler&#39;</span><span class="p">,</span>
                <span class="s1">&#39;warning handler&#39;</span><span class="p">,</span> <span class="s1">&#39;info handler&#39;</span><span class="p">,</span> <span class="s1">&#39;debug handler&#39;</span><span class="p">,</span> <span class="s1">&#39;verbose mode&#39;</span><span class="p">,</span>
                <span class="s1">&#39;quiet mode&#39;</span><span class="p">,</span> <span class="s1">&#39;silent mode&#39;</span><span class="p">,</span> <span class="s1">&#39;normal mode&#39;</span><span class="p">,</span> <span class="s1">&#39;fast mode&#39;</span><span class="p">,</span>
                <span class="s1">&#39;slow mode&#39;</span><span class="p">,</span> <span class="s1">&#39;high level&#39;</span><span class="p">,</span> <span class="s1">&#39;low level&#39;</span><span class="p">,</span> <span class="s1">&#39;medium level&#39;</span><span class="p">,</span>
                <span class="s1">&#39;small size&#39;</span><span class="p">,</span> <span class="s1">&#39;large size&#39;</span><span class="p">,</span> <span class="s1">&#39;big size&#39;</span><span class="p">,</span> <span class="s1">&#39;tiny size&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min value&#39;</span><span class="p">,</span> <span class="s1">&#39;max value&#39;</span><span class="p">,</span> <span class="s1">&#39;avg value&#39;</span><span class="p">,</span> <span class="s1">&#39;sum value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;count value&#39;</span><span class="p">,</span> <span class="s1">&#39;total value&#39;</span><span class="p">,</span> <span class="s1">&#39;size value&#39;</span><span class="p">,</span> <span class="s1">&#39;length value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;width value&#39;</span><span class="p">,</span> <span class="s1">&#39;height value&#39;</span><span class="p">,</span> <span class="s1">&#39;depth value&#39;</span><span class="p">,</span> <span class="s1">&#39;weight value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;speed value&#39;</span><span class="p">,</span> <span class="s1">&#39;time value&#39;</span><span class="p">,</span> <span class="s1">&#39;date value&#39;</span><span class="p">,</span> <span class="s1">&#39;year value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;month value&#39;</span><span class="p">,</span> <span class="s1">&#39;day value&#39;</span><span class="p">,</span> <span class="s1">&#39;hour value&#39;</span><span class="p">,</span> <span class="s1">&#39;minute value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;second value&#39;</span><span class="p">,</span> <span class="s1">&#39;millisecond value&#39;</span><span class="p">,</span> <span class="s1">&#39;microsecond value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nanosecond value&#39;</span><span class="p">,</span> <span class="s1">&#39;true value&#39;</span><span class="p">,</span> <span class="s1">&#39;false value&#39;</span><span class="p">,</span> <span class="s1">&#39;yes value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;no value&#39;</span><span class="p">,</span> <span class="s1">&#39;on value&#39;</span><span class="p">,</span> <span class="s1">&#39;off value&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;disabled value&#39;</span><span class="p">,</span> <span class="s1">&#39;active value&#39;</span><span class="p">,</span> <span class="s1">&#39;inactive value&#39;</span><span class="p">,</span> <span class="s1">&#39;running value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;stopped value&#39;</span><span class="p">,</span> <span class="s1">&#39;paused value&#39;</span><span class="p">,</span> <span class="s1">&#39;resumed value&#39;</span><span class="p">,</span> <span class="s1">&#39;started value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;finished value&#39;</span><span class="p">,</span> <span class="s1">&#39;completed value&#39;</span><span class="p">,</span> <span class="s1">&#39;failed value&#39;</span><span class="p">,</span> <span class="s1">&#39;success value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ok value&#39;</span><span class="p">,</span> <span class="s1">&#39;okay value&#39;</span><span class="p">,</span> <span class="s1">&#39;good value&#39;</span><span class="p">,</span> <span class="s1">&#39;bad value&#39;</span><span class="p">,</span> <span class="s1">&#39;great value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;awesome value&#39;</span><span class="p">,</span> <span class="s1">&#39;cool value&#39;</span><span class="p">,</span> <span class="s1">&#39;nice value&#39;</span><span class="p">,</span> <span class="s1">&#39;perfect value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;excellent value&#39;</span><span class="p">,</span> <span class="s1">&#39;wonderful value&#39;</span><span class="p">,</span> <span class="s1">&#39;amazing value&#39;</span><span class="p">,</span> <span class="s1">&#39;incredible value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fantastic value&#39;</span><span class="p">,</span> <span class="s1">&#39;terrible value&#39;</span><span class="p">,</span> <span class="s1">&#39;awful value&#39;</span><span class="p">,</span> <span class="s1">&#39;horrible value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;disgusting value&#39;</span><span class="p">,</span> <span class="s1">&#39;ugly value&#39;</span><span class="p">,</span> <span class="s1">&#39;beautiful value&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;cute value&#39;</span><span class="p">,</span> <span class="s1">&#39;lovely value&#39;</span><span class="p">,</span> <span class="s1">&#39;sweet value&#39;</span><span class="p">,</span> <span class="s1">&#39;kind value&#39;</span><span class="p">,</span> <span class="s1">&#39;nice value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;good value&#39;</span><span class="p">,</span> <span class="s1">&#39;bad value&#39;</span><span class="p">,</span> <span class="s1">&#39;evil value&#39;</span><span class="p">,</span> <span class="s1">&#39;wrong value&#39;</span><span class="p">,</span> <span class="s1">&#39;right value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;correct value&#39;</span><span class="p">,</span> <span class="s1">&#39;incorrect value&#39;</span><span class="p">,</span> <span class="s1">&#39;valid value&#39;</span><span class="p">,</span> <span class="s1">&#39;invalid value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;legal value&#39;</span><span class="p">,</span> <span class="s1">&#39;illegal value&#39;</span><span class="p">,</span> <span class="s1">&#39;allowed value&#39;</span><span class="p">,</span> <span class="s1">&#39;forbidden value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;permitted value&#39;</span><span class="p">,</span> <span class="s1">&#39;denied value&#39;</span><span class="p">,</span> <span class="s1">&#39;granted value&#39;</span><span class="p">,</span> <span class="s1">&#39;refused value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;accepted value&#39;</span><span class="p">,</span> <span class="s1">&#39;rejected value&#39;</span><span class="p">,</span> <span class="s1">&#39;approved value&#39;</span><span class="p">,</span> <span class="s1">&#39;disapproved value&#39;</span><span class="p">,</span>
                <span class="s1">&#39;confirmed value&#39;</span><span class="p">,</span> <span class="s1">&#39;denied value&#39;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">technical_phrases</span>

        <span class="c1"># Skip very short phrases</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Skip phrases that are mostly technical</span>
        <span class="n">technical_phrases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;hello world&#39;</span><span class="p">,</span> <span class="s1">&#39;test case&#39;</span><span class="p">,</span> <span class="s1">&#39;demo app&#39;</span><span class="p">,</span> <span class="s1">&#39;example code&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sample data&#39;</span><span class="p">,</span> <span class="s1">&#39;config file&#39;</span><span class="p">,</span> <span class="s1">&#39;settings file&#39;</span><span class="p">,</span> <span class="s1">&#39;options menu&#39;</span><span class="p">,</span>
            <span class="s1">&#39;input field&#39;</span><span class="p">,</span> <span class="s1">&#39;output field&#39;</span><span class="p">,</span> <span class="s1">&#39;result set&#39;</span><span class="p">,</span> <span class="s1">&#39;data table&#39;</span><span class="p">,</span>
            <span class="s1">&#39;error message&#39;</span><span class="p">,</span> <span class="s1">&#39;warning message&#39;</span><span class="p">,</span> <span class="s1">&#39;info message&#39;</span><span class="p">,</span> <span class="s1">&#39;debug info&#39;</span><span class="p">,</span>
            <span class="s1">&#39;log file&#39;</span><span class="p">,</span> <span class="s1">&#39;trace file&#39;</span><span class="p">,</span> <span class="s1">&#39;stack trace&#39;</span><span class="p">,</span> <span class="s1">&#39;exception handler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;error handler&#39;</span><span class="p">,</span> <span class="s1">&#39;warning handler&#39;</span><span class="p">,</span> <span class="s1">&#39;info handler&#39;</span><span class="p">,</span> <span class="s1">&#39;debug handler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;verbose mode&#39;</span><span class="p">,</span> <span class="s1">&#39;quiet mode&#39;</span><span class="p">,</span> <span class="s1">&#39;silent mode&#39;</span><span class="p">,</span> <span class="s1">&#39;normal mode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fast mode&#39;</span><span class="p">,</span> <span class="s1">&#39;slow mode&#39;</span><span class="p">,</span> <span class="s1">&#39;high level&#39;</span><span class="p">,</span> <span class="s1">&#39;low level&#39;</span><span class="p">,</span> <span class="s1">&#39;medium level&#39;</span><span class="p">,</span>
            <span class="s1">&#39;small size&#39;</span><span class="p">,</span> <span class="s1">&#39;large size&#39;</span><span class="p">,</span> <span class="s1">&#39;big size&#39;</span><span class="p">,</span> <span class="s1">&#39;tiny size&#39;</span><span class="p">,</span> <span class="s1">&#39;min value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max value&#39;</span><span class="p">,</span> <span class="s1">&#39;avg value&#39;</span><span class="p">,</span> <span class="s1">&#39;sum value&#39;</span><span class="p">,</span> <span class="s1">&#39;count value&#39;</span><span class="p">,</span> <span class="s1">&#39;total value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;size value&#39;</span><span class="p">,</span> <span class="s1">&#39;length value&#39;</span><span class="p">,</span> <span class="s1">&#39;width value&#39;</span><span class="p">,</span> <span class="s1">&#39;height value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;depth value&#39;</span><span class="p">,</span> <span class="s1">&#39;weight value&#39;</span><span class="p">,</span> <span class="s1">&#39;speed value&#39;</span><span class="p">,</span> <span class="s1">&#39;time value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;date value&#39;</span><span class="p">,</span> <span class="s1">&#39;year value&#39;</span><span class="p">,</span> <span class="s1">&#39;month value&#39;</span><span class="p">,</span> <span class="s1">&#39;day value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hour value&#39;</span><span class="p">,</span> <span class="s1">&#39;minute value&#39;</span><span class="p">,</span> <span class="s1">&#39;second value&#39;</span><span class="p">,</span> <span class="s1">&#39;millisecond value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;microsecond value&#39;</span><span class="p">,</span> <span class="s1">&#39;nanosecond value&#39;</span><span class="p">,</span> <span class="s1">&#39;true value&#39;</span><span class="p">,</span> <span class="s1">&#39;false value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;yes value&#39;</span><span class="p">,</span> <span class="s1">&#39;no value&#39;</span><span class="p">,</span> <span class="s1">&#39;on value&#39;</span><span class="p">,</span> <span class="s1">&#39;off value&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;disabled value&#39;</span><span class="p">,</span> <span class="s1">&#39;active value&#39;</span><span class="p">,</span> <span class="s1">&#39;inactive value&#39;</span><span class="p">,</span> <span class="s1">&#39;running value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;stopped value&#39;</span><span class="p">,</span> <span class="s1">&#39;paused value&#39;</span><span class="p">,</span> <span class="s1">&#39;resumed value&#39;</span><span class="p">,</span> <span class="s1">&#39;started value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;finished value&#39;</span><span class="p">,</span> <span class="s1">&#39;completed value&#39;</span><span class="p">,</span> <span class="s1">&#39;failed value&#39;</span><span class="p">,</span> <span class="s1">&#39;success value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ok value&#39;</span><span class="p">,</span> <span class="s1">&#39;okay value&#39;</span><span class="p">,</span> <span class="s1">&#39;good value&#39;</span><span class="p">,</span> <span class="s1">&#39;bad value&#39;</span><span class="p">,</span> <span class="s1">&#39;great value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;awesome value&#39;</span><span class="p">,</span> <span class="s1">&#39;cool value&#39;</span><span class="p">,</span> <span class="s1">&#39;nice value&#39;</span><span class="p">,</span> <span class="s1">&#39;perfect value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;excellent value&#39;</span><span class="p">,</span> <span class="s1">&#39;wonderful value&#39;</span><span class="p">,</span> <span class="s1">&#39;amazing value&#39;</span><span class="p">,</span> <span class="s1">&#39;incredible value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fantastic value&#39;</span><span class="p">,</span> <span class="s1">&#39;terrible value&#39;</span><span class="p">,</span> <span class="s1">&#39;awful value&#39;</span><span class="p">,</span> <span class="s1">&#39;horrible value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;disgusting value&#39;</span><span class="p">,</span> <span class="s1">&#39;ugly value&#39;</span><span class="p">,</span> <span class="s1">&#39;beautiful value&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cute value&#39;</span><span class="p">,</span> <span class="s1">&#39;lovely value&#39;</span><span class="p">,</span> <span class="s1">&#39;sweet value&#39;</span><span class="p">,</span> <span class="s1">&#39;kind value&#39;</span><span class="p">,</span> <span class="s1">&#39;nice value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;good value&#39;</span><span class="p">,</span> <span class="s1">&#39;bad value&#39;</span><span class="p">,</span> <span class="s1">&#39;evil value&#39;</span><span class="p">,</span> <span class="s1">&#39;wrong value&#39;</span><span class="p">,</span> <span class="s1">&#39;right value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;correct value&#39;</span><span class="p">,</span> <span class="s1">&#39;incorrect value&#39;</span><span class="p">,</span> <span class="s1">&#39;valid value&#39;</span><span class="p">,</span> <span class="s1">&#39;invalid value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;legal value&#39;</span><span class="p">,</span> <span class="s1">&#39;illegal value&#39;</span><span class="p">,</span> <span class="s1">&#39;allowed value&#39;</span><span class="p">,</span> <span class="s1">&#39;forbidden value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;permitted value&#39;</span><span class="p">,</span> <span class="s1">&#39;denied value&#39;</span><span class="p">,</span> <span class="s1">&#39;granted value&#39;</span><span class="p">,</span> <span class="s1">&#39;refused value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;accepted value&#39;</span><span class="p">,</span> <span class="s1">&#39;rejected value&#39;</span><span class="p">,</span> <span class="s1">&#39;approved value&#39;</span><span class="p">,</span> <span class="s1">&#39;disapproved value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;confirmed value&#39;</span><span class="p">,</span> <span class="s1">&#39;denied value&#39;</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">technical_phrases</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_url_or_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if text is a URL or email address.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the text is a URL or email address</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

        <span class="c1"># URL pattern</span>
        <span class="n">url_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^https?://|^ftp://|^file://|^www\.&#39;</span>
        <span class="c1"># Email pattern</span>
        <span class="n">email_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$&#39;</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">url_pattern</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">email_pattern</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_contains_non_english</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if text contains non-English (non-ASCII) characters.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the text contains non-ASCII characters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if any character is outside the ASCII range (0-127)</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rebuild_string_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">translated_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rebuild a string token with translated content while preserving quote style.</span>

<span class="sd">        Args:</span>
<span class="sd">            original_token: The original string token (including quotes)</span>
<span class="sd">            translated_content: The translated content (without quotes)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The rebuilt string token with the same quote style</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract prefix (f, r, b, etc.)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">original_token</span>
        <span class="k">while</span> <span class="n">token</span> <span class="ow">and</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s1">&#39;frbufrburfbr&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Detect the quote style</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">translated_content</span><span class="si">}</span><span class="s1">&quot;&quot;&quot;&#39;</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&#39;&#39;&#39;</span><span class="si">{</span><span class="n">translated_content</span><span class="si">}</span><span class="s2">&#39;&#39;&#39;&quot;</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&quot;</span><span class="si">{</span><span class="n">translated_content</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">translated_content</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: use double quotes</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&quot;</span><span class="si">{</span><span class="n">translated_content</span><span class="si">}</span><span class="s1">&quot;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_replace_token_in_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">token</span><span class="p">:</span> <span class="n">PythonToken</span><span class="p">,</span> <span class="n">new_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace a token in the lines list with new content.</span>

<span class="sd">        Args:</span>
<span class="sd">            lines: List of lines (modified in place)</span>
<span class="sd">            token: Token to replace</span>
<span class="sd">            new_content: New content to replace with</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle multi-line tokens (like multi-line docstrings)</span>
        <span class="n">start_line</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Convert to 0-based index</span>
        <span class="n">end_line</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">start_line</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="ow">or</span> <span class="n">start_line</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">start_line</span> <span class="o">==</span> <span class="n">end_line</span><span class="p">:</span>
            <span class="c1"># Single-line token</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span>
            <span class="n">start_col</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">end_col</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Replace the token in the line</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">start_col</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_content</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="n">end_col</span><span class="p">:]</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Multi-line token (e.g., multi-line docstring)</span>
            <span class="n">start_col</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">end_col</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get content before token on start line</span>
            <span class="n">before_token</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">start_line</span><span class="p">][:</span><span class="n">start_col</span><span class="p">]</span>

            <span class="c1"># Get content after token on end line (if end line exists)</span>
            <span class="n">after_token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">end_line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="n">after_token</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">end_line</span><span class="p">][</span><span class="n">end_col</span><span class="p">:]</span>

            <span class="c1"># Replace: keep before, insert new content, keep after</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">before_token</span> <span class="o">+</span> <span class="n">new_content</span> <span class="o">+</span> <span class="n">after_token</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_line</span>

            <span class="c1"># Remove the middle and end lines</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end_line</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Zhiang He.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>